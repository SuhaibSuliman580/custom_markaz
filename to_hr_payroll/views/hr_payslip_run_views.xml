<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<record id="hr_payslip_run_filter" model="ir.ui.view">
		<field name="name">hr.payslip.run.search</field>
		<field name="model">hr.payslip.run</field>
		<field name="arch" type="xml">
			<search string="Search Payslip Batches">
				<field name="name" string="Payslip Batches" />
				<field name="date_start" />
				<field name="date_end" />
				<separator />
				<filter string="Draft" name="draft"
					domain="[('state','=','draft')]" help="Draft Payslip Batches" />
				<filter name="done_filter" string="Done"
					domain="[('state','=','close')]" help="Done Payslip Batches" />
				<separator />
				<filter name="ftr_13month" string="13rd-Month Pay Only"
					domain="[('thirteen_month_pay', '=', True)]" />
				<filter name="ftr_no_13month" string="Without 13rd-Month Pay"
					domain="[('thirteen_month_pay', '=', False)]" />
			</search>
		</field>
	</record>

	<record id="hr_payslip_run_tree" model="ir.ui.view">
		<field name="name">hr.payslip.run.tree</field>
		<field name="model">hr.payslip.run</field>
		<field name="arch" type="xml">
			<tree string="Payslips Batches"
				decoration-info="state=='verified'"
				decoration-muted="state == 'cancelled'" sample="1">
				<field name="name" />
				<field name="date_start" />
				<field name="date_end" />
				<field name="employees_count" />
				<field name="contracts_count" />
				<field name="payslips_count" />
				<field name="credit_note" />
				<field name="total_net_amount" />
				<field name="company_cost" />
				<field name="thirteen_month_pay" />
				<field name="state" />
				<field name="company_id" groups="base.group_multi_company" />
			</tree>
		</field>
	</record>

	<record model="ir.ui.view" id="hr_payslip_run_pivot">
		<field name="name">hr.payslip.run.pivot</field>
		<field name="model">hr.payslip.run</field>
		<field name="arch" type="xml">
			<pivot string="Payslip Batches Statistics" sample="1">
				<field name="total_net_amount" type="measure" />
				<field name="date_start" type="col" />
			</pivot>
		</field>
	</record>

	<record model="ir.ui.view" id="hr_payslip_run_graph">
		<field name="name">hr.payslip.run.graph</field>
		<field name="model">hr.payslip.run</field>
		<field name="arch" type="xml">
			<graph string="Payslip Batches Statistics" sample="1">
				<field name="total_net_amount" type="measure" />
				<field name="date_start" type="col" />
			</graph>
		</field>
	</record>

	<record id="hr_payslip_run_view_kanban" model="ir.ui.view">
		<field name="name">hr.payslip.run.kanban</field>
		<field name="model">hr.payslip.run</field>
		<field name="arch" type="xml">
			<kanban class="o_kanban_mobile">
				<templates>
					<t t-name="kanban-box">
						<div t-attf-class="oe_kanban_content oe_kanban_global_click">
							<div class="row">
								<div class="col-6">
									<strong>
										<field name="name" />
									</strong>
								</div>
								<div class="col-6">
									<span class="float-end badge bg-secondary">
										<field name="state" />
									</span>
								</div>
								<div class="col-12">
									<span>
										<field name="date_start" />
										-
										<field name="date_end" />
									</span>
									<span class="float-end" title="Is a Blocking Reason?">
										<field name="credit_note" widget="boolean" />
									</span>
								</div>
							</div>
						</div>
					</t>
				</templates>
			</kanban>
		</field>
	</record>

	<record id="hr_payslip_run_form" model="ir.ui.view">
		<field name="name">hr.payslip.run.form</field>
		<field name="model">hr.payslip.run</field>
		<field name="arch" type="xml">
			<form string="Payslips Batches">
				<header>
					<button name="%(action_hr_payslip_by_employees)d"
						type="action" string="Generate Payslips"
						invisible="state != 'draft'"
						class="oe_highlight" />
					<button string="Set to Draft" name="draft_payslip_run"
						type="object" invisible="state != 'cancelled'" />
					<button name="action_check_payslip_duplication"
						string="Check Payslip Duplication"
						help="Click here to check if any duplication of payslips of the same employee that overlaps payslip period."
						type="object"
						invisible="not slip_ids or state != 'draft'" />
					<button name="action_compute_sheets"
						string="Compute Payslip Batch"
						help="Click here to compute all payslips of this batch"
						type="object"
						invisible="not slip_ids or state != 'draft'" />
					<button name="action_calculate_wage"
						string="Calculate Wages" type="object"
						help="Only recalculate the salary amount of all payslips in this payroll."
						invisible="not slip_ids or state != 'draft'" />
					<button name="action_verify_payslips"
						string="Verify Payslips"
						help="Click here to verify all draft payslip of this batch"
						type="object" class="oe_highlight"
						invisible="not slip_ids or state != 'draft'" />
					<button name="close_payslip_run" type="object"
						string="Close" invisible="state != 'verified'" class="oe_highlight" />
					<button name="action_payslipbatch_send"
						string="Send by Email" type="object" />
					<button name="action_cancel" string="Cancel" type="object"
						invisible="state not in ['verified', 'close']"
						confirm="This will cancel all the payslips of this batch. Are you sure?" />
					<field name="state" widget="statusbar" />
				</header>
				<sheet>
					<div class="oe_button_box" name="button_box">
						<button name="action_view_employees" class="oe_stat_button"
							icon="fa-users" type="object">
							<field name="employees_count" widget="statinfo"
								string="Employees" />
						</button>
						<button name="action_view_contracts" class="oe_stat_button"
							icon="fa-book" type="object"
							groups="hr_contract.group_hr_contract_manager">
							<field name="contracts_count" widget="statinfo"
								string="Contracts" />
						</button>
						<button name="action_view_payslips" class="oe_stat_button"
							icon="fa-money" type="object"
							groups="to_hr_payroll.group_hr_payroll_user">
							<field name="payslips_count" widget="statinfo"
								string="Payslips" />
						</button>
						<button name="action_view_payslip_lines" class="oe_stat_button"
							icon="fa-money" type="object"
							groups="to_hr_payroll.group_hr_payroll_user">
							<field name="payslip_lines_count" widget="statinfo"
								string="Payslip Lines" />
						</button>
					</div>
					<group>
						<group>
							<field name="name" readonly="state != 'draft'" />
							<field name="salary_cycle_id" readonly="state != 'draft'" />
							<field name="thirteen_month_pay"
								readonly="state != 'draft'" />
							<field name="thirteen_month_pay_year"
								readonly="state != 'draft'"
								invisible="not thirteen_month_pay"
								required="thirteen_month_pay" />
							<field name="thirteen_month_pay_include_trial"
								readonly="state != 'draft'"
								invisible="not thirteen_month_pay" />
							<label for="date_start" string="Period" />
							<div name='payroll_duration'>
								<field name="date_start" class="oe_inline"
									readonly="state != 'draft'" />
								-
								<field name="date_end" class="oe_inline"
									readonly="state != 'draft'" />
							</div>
							<field name="credit_note" readonly="state != 'draft'" />
						</group>
						<group>
							<field name="company_id"
								readonly="state != 'draft'"
								groups="base.group_multi_company"
								options="{'no_create': True}" />
							<field name="currency_id" invisible="1" />
						</group>
					</group>
					<div name="warning_we_no_exists_text" class="alert alert-warning" role="alert"
						invisible="not warning_we_no_exists_text" >
						<field name="warning_we_no_exists_text" />
					</div>
					<div name="warning_we_conflict_text" class="alert alert-warning" role="alert"
						invisible="not warning_we_conflict_text" >
						<field name="warning_we_conflict_text" />
					</div>
					<div name="warning_we_no_validate_text" class="alert alert-warning" role="alert"
						invisible="not warning_we_no_validate_text" >
						<field name="warning_we_no_validate_text" />
					</div>
					<separator string="Payslips" />
					<field name="slip_ids" readonly="state != 'draft'"
						context="{
						'default_thirteen_month_pay':thirteen_month_pay,
						'default_date_from':date_start,
						'default_date_to':date_end,
						'default_payslip_run_id': id,
						}" />
					<!-- Totals -->
					<group class="oe_right">
						<group class="oe_subtotal_footer">
							<field name="total_net_amount" string="Net" />
						</group>
					</group>
				</sheet>
				<div class="oe_chatter">
					<field name="message_follower_ids" groups="base.group_user" />
					<field name="activity_ids"/>
					<field name="message_ids"/>
				</div>
			</form>
		</field>
	</record>

	<record id="action_hr_payslip_run_tree"
		model="ir.actions.act_window">
		<field name="name">Payslips Batches</field>
		<field name="res_model">hr.payslip.run</field>
		<field name="view_mode">tree,kanban,form,pivot,graph</field>
		<field name="search_view_id" ref="hr_payslip_run_filter" />
	</record>

	<menuitem action="action_hr_payslip_run_tree" sequence="15"
		id="menu_hr_payslip_run" parent="menu_payslips_root" />

</odoo>
